<!DOCTYPE html>
<html>

<head>
    <script src="autobahn.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.17/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.17/angular-route.min.js"></script>
    <script src="thruway.js"></script>

</head>

<body ng-app="MyApp">

<div ng-view></div>


<script>
    var myApp = angular.module("MyApp", ["thruway", 'ngRoute']);

    function MyController($scope, $thruway, $location) {

        $scope.messages = $thruway('entity.node.page').getList();

//        $scope.articles = new $thruway('entity.node.article');

        $scope.$on("thruway.auth", function (event, message) {
            $location.path('/login').replace();
            $scope.$apply();
        });

    }

    function LoginCtrl($scope) {

        $scope.login = function (user) {
            $scope.$emit("thruway.login", user);
        };

    }


    myApp.config(['$routeProvider', function ($routeProvider) {

        $routeProvider
                .when('/', {
                    templateUrl: 'partials/main.html',
                    controller: 'MyController'
                })
                .when('/login', {
                    templateUrl: 'partials/login.html',
                    controller: 'LoginCtrl'
                })
                .otherwise({
                    redirectTo: '/'
                });
    }]);


    myApp.config(function ($provide) {
        $provide.decorator('thruwaySettings', function ($delegate) {
            return {
                url: "ws://demo.thruway.ws:9090",
                realm: 'drupalrealm'
            }
        });
    });

</script>

</body>

</html>